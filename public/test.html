<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!--Flickity CSS -->
    <link rel="stylesheet" href="./assets/css/flickity.min.css">
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="./assets/css/tailwind.css">

    <link type="text/css" rel="stylesheet" href="./assets/css/magicscroll.css" />

</head>

<body>

    <div class="h-56 flex flex-col justify-center overflow-y-scroll" x-data="infinity()"
        @scroll.self="scroll($event.target)" id="scroll-content">
        <div class="w-full ">1</div>
        <div class="w-full ">2</div>
        <div class="w-full ">3</div>
        <div class="w-full ">4</div>
        <div class="w-full ">5</div>
        <div class="w-full ">6</div>
        <div class="w-full ">7</div>
        <div class="w-full ">8</div>
        <div class="w-full ">9</div>
        <div class="w-full ">10</div>
        <div class="w-full ">11</div>
        <div class="w-full ">12</div>
        <div class="w-full ">13</div>
    </div>

    <!-- Magic Scroll -->
    <script type="text/javascript" src="./assets/js/magicscroll.js"></script>
    <!-- Flickity.js -->
    <script src="./assets/js/flickity.pkgd.min.js"></script>
    <!-- Alpine.js -->
    <script src="./assets/js/alpine.min.js"></script>

    <script>
        function infinity() {
            return {
                scroll(el) {
                    var element = el;
                    var lastDiv = document.querySelector("#scroll-content > div:last-child");
                    var lastDivOffset = lastDiv.offsetTop + lastDiv.clientHeight;
                    var elementOffset = element.scrollTop + element.clientHeight;

                    if (elementOffset > lastDivOffset - 2) {
                        element.append(element.firstElementChild);
                    }

                    if (element.scrollTop < lastDiv.clientHeight - 10) {
                        element.prepend(element.lastElementChild);

                    }
                }
            }
        }
        // document.querySelector('#scroll-content').addEventListener("scroll", function (event) {
        //     var i = 1;
        //     var div = document.getElementById("scroll-content");
        //     // console.log(div.offsetTop);

        //     // console.log(event);
        //     checkForNewDiv();
        // });

        // var checkForNewDiv = function (e) {

        //     var div = document.getElementById("scroll-content");
        //     var lastDiv = document.querySelector("#scroll-content > div:last-child");
        //     var lastDivOffset = lastDiv.offsetTop + lastDiv.clientHeight;
        //     var pageOffset = div.scrollTop + div.clientHeight;
        //     console.log(div.scrollTop);
        //     console.log(lastDivOffset);
        //     if (pageOffset > lastDivOffset - 2) {
        //         console.log(true);
        //         var newDiv = document.createElement("div");
        //         newDiv.innerHTML = "my awesome new div";
        //         document.getElementById("scroll-content").appendChild(newDiv);
        //         checkForNewDiv();
        //     }
        // };

        // checkForNewDiv();
    </script>
</body>

</html>